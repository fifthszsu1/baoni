# 阿里云部署故障排查指南

## 🔍 问题：访问8081端口显示nginx默认页面

### 可能原因和解决方案

#### 1. 检查容器状态
```bash
# 查看容器运行状态
docker-compose ps

# 查看容器日志
docker-compose logs frontend
docker-compose logs backend
```

#### 2. 检查前端构建文件
```bash
# 进入前端容器
docker exec -it baoni-frontend /bin/bash

# 检查文件是否存在
ls -la /usr/share/nginx/html/

# 检查index.html内容
cat /usr/share/nginx/html/index.html

# 检查静态文件
ls -la /usr/share/nginx/html/static/
```

#### 3. 检查nginx配置
```bash
# 检查nginx配置
docker exec baoni-frontend nginx -T

# 检查nginx错误日志
docker exec baoni-frontend tail -f /var/log/nginx/error.log
```

#### 4. 重新构建前端
```bash
# 停止前端容器
docker-compose stop frontend

# 删除前端镜像
docker rmi baoni-frontend

# 重新构建前端
docker-compose up -d --build frontend
```

#### 5. 检查网络连接
```bash
# 测试后端连接
curl http://localhost:5001/health

# 测试前端连接
curl http://localhost:8081/
```

#### 6. 完整重建流程
```bash
# 停止所有容器
docker-compose down

# 清理所有镜像
docker system prune -af

# 重新构建并启动
docker-compose up -d --build
```

### 常见问题解决

#### 问题1：前端构建失败
```bash
# 在阿里云服务器上手动构建前端
cd frontend
npm install
npm run build
```

#### 问题2：nginx配置问题
```bash
# 重启nginx
docker exec baoni-frontend nginx -s reload
```

#### 问题3：文件权限问题
```bash
# 修复文件权限
docker exec baoni-frontend chown -R nginx:nginx /usr/share/nginx/html/
```

### 调试命令

```bash
# 查看容器详细信息
docker inspect baoni-frontend

# 查看容器资源使用
docker stats

# 查看系统日志
docker-compose logs --tail=100
```

### 联系支持

如果以上方法都无法解决问题，请提供：
1. `docker-compose ps` 输出
2. `docker-compose logs frontend` 输出
3. `docker exec baoni-frontend ls -la /usr/share/nginx/html/` 输出 